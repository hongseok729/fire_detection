<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ”¥ í™”ì¬ ê°ì§€ ê´€ì œì„¼í„°</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <h1>ğŸ”¥ í™”ì¬ ê°ì§€ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</h1>

  <img src="/video" alt="í™”ì¬ ê°ì§€ í™”ë©´" />

  
  <h2 id="status">ìƒíƒœ: {{ status }}</h2>

  <audio id="alarm-sound" src="/static/alarm.mp3"></audio>
  <audio id="tts-sound" src="/static/tts.mp3"></audio>

  <div class="footer">
    ğŸ“  Fire Object Detection YOLOv11-s | JEON HONG SEOK
  </div>

  <script>
    let prevStatus = "ì •ìƒ";

    function playSounds() {
      const alarm = document.getElementById("alarm-sound");
      const tts = document.getElementById("tts-sound");

      // ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì¬ìƒí•˜ë„ë¡ ì„¤ì •
      alarm.currentTime = 0;
      tts.currentTime = 0;

      alarm.play().then(() => {
        // ì•ŒëŒì´ ëë‚˜ê³  ë‚˜ì„œ TTS ì¬ìƒ (ì˜ˆ: 1.5ì´ˆ í›„)
        setTimeout(() => {
          tts.play();
        }, 1500);
      }).catch(e => {
        console.log("ì•ŒëŒ ì¬ìƒ ì‹¤íŒ¨:", e);
      });
    }

    setInterval(() => {
      fetch('/status')
        .then(response => response.text())
        .then(text => {
          document.getElementById("status").innerText = "ìƒíƒœ: " + text;

          // ìƒíƒœ ë³€í™”ê°€ ìˆì„ ë•Œë§Œ ì†Œë¦¬ ì¬ìƒ
          if ((text.includes("í™”ì¬") || text.includes("ì—°ê¸°")) && text !== prevStatus) {
            playSounds();
          }

          prevStatus = text;
        });
    }, 1000);
  </script>
</body>
</html>
